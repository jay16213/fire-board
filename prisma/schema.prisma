// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Stock {
  id                    String                  @id // 股票代號
  name                  String
  industryType          String
  isEtf                 Boolean
  StockPosition         StockPosition[]
  StockExDividendRecord StockExDividendRecord[]
}

model StockAccount {
  id                    Int                     @id @default(autoincrement())
  name                  String                  @unique
  minFee                Int
  regularFee            Int
  feeDiscount           Decimal
  StockPosition         StockPosition[]
  StockTransaction      StockTransaction[]
  StockExDividendRecord StockExDividendRecord[]
}

model StockPosition {
  account                 StockAccount @relation(fields: [stockAccountId], references: [id])
  stockAccountId          Int
  stock                   Stock        @relation(fields: [stockId], references: [id])
  stockId                 String
  shares                  Int
  //現價
  price                   Decimal
  //市值
  marketValue             Int
  avgCost                 Decimal
  cost                    Int
  balancePrice            Decimal
  // 未實現損益
  unrealizedGainLoss      Int
  // 未實現損益率
  unrealizedGainLossRatio Decimal

  @@id([stockAccountId, stockId])
}

// 股票總市值
model StockValueTrend {
  id        Int      @id @default(autoincrement())
  value     Int
  updatedAt DateTime @updatedAt
}

model StockTransaction {
  id               Int          @id @default(autoincrement())
  date             DateTime
  account          StockAccount @relation(fields: [stockAccountId], references: [id])
  stockAccountId   Int
  stockId          String
  stockName        String
  type             String // '一般', 'ETF', '定期定額'
  sellOrBuy        String // '買', '賣'
  shares           Int
  price            Decimal
  amount           Int // 成交價金
  fee              Int
  feeAfterDiscount Int
  transactionTax   Int
  transactionCost  Int // 交易成本 = 交易手續費(折讓後) + 賣出交易稅
  actualPayment    Int // 實際收付
  bookPayment      Int // 帳面收付
}

// 除權息紀錄
model StockExDividendRecord {
  id                   Int          @id @default(autoincrement())
  exDividendDate       DateTime
  dividendPayDate      DateTime
  account              StockAccount @relation(fields: [stockAccountId], references: [id])
  stockAccountId       Int
  stock                Stock        @relation(fields: [stockId], references: [id])
  stockId              String
  shares               Int
  cashDividend         Decimal
  cashDividendPayable  Int
  stockDividend        Decimal
  stockDividendPayable Int
  tax                  Int
  fee                  Int
  healthInsurance      Int
  cashActualPayment    Int
  stockActualPayment   Int
}
